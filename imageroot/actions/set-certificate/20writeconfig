#!/usr/bin/env python3

#
# Copyright (C) 2025 Nethesis S.r.l.
# SPDX-License-Identifier: GPL-3.0-or-later
#

import json
import sys
import os
import cert_helpers

def main():
    request = json.load(sys.stdin)
    cert_helpers.add_default_certificate_name(request['fqdn'])
    if request.get('sync'):
        obtained = cert_helpers.wait_acmejson_sync(timeout=request.get('sync_timeout', 120))
    else:
        obtained = False
    json.dump({"obtained": obtained}, fp=sys.stdout)
    if request.get('sync') is not None and obtained is False:
        exit(2)

if __name__ == "__main__":
    main()
