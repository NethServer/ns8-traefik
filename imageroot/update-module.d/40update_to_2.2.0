#!/usr/bin/env python3

#
# Copyright (C) 2024 Nethesis S.r.l.
# SPDX-License-Identifier: GPL-3.0-or-later
#

import os

import agent

# Connect to redis using module credentials
agent_id = os.getenv("AGENT_ID")
redis_client = agent.redis_connect(privileged=True)
# Check if the hosts key exists, if not, use write-hosts to populate it
if not redis_client.exists(f'{agent_id}/hosts'):
    agent.run_helper(['../bin/write-hosts'])
